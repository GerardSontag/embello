Reformat A drive in RAM to 360K -jcw, 2017-03-19 Z80ASM 1.32 Page   1
FMT360  Z80

    2                   
    3                   ; Usage: fmt360
    4                   
    5         0000      WSTART	equ	0000h
    6         0005      BDOS	equ	0005h
    7                   
    8         000E      SELDSK  equ     14
    9         0013      DELF	equ	19
   10         001F      GETADR  equ     31
   11         0025      RSTDRV  equ     37
   12                   
   13         0100      	org 100h
   14                   
   15 0100  1E 00               ld e,0          ; select drive A:
   16 0102  0E 0E               ld c,SELDSK
   17 0104  CD 0005             call BDOS
   18                   
   19 0107  11 0137             ld de,fcb
   20 010A  0E 13               ld c,DELF       ; delete all files
   21 010C  CD 0005             call BDOS
   22                   
   23 010F  0E 1F               ld c,GETADR     ; get DPB of A:
   24 0111  CD 0005             call BDOS
   25                   
   26 0114  EB                  ex de,hl        ; overwrite with our version
   27 0115  21 0128             ld hl,dpb
   28 0118  01 000F             ld bc,dpblen
   29 011B  ED B0               ldir
   30                   
   31 011D  11 0001             ld de,1         ; reset drive A:
   32 0120  0E 25               ld c,RSTDRV
   33 0122  CD 0005             call BDOS
   34                   
   35 0125  C3 0000             jp WSTART
   36                   
   37 0128  001A        dpb:	dw 26  ; SPT - sectors per track
   38 012A  04          	db 4   ; BSH - block shift factor
   39 012B  0F          	db 15  ; BLM - block mask
   40 012C  01          	db 1   ; EXM - Extent mask
   41 012D  00AF        	dw 175 ; DSM - Storage size (blocks - 1)
   42 012F  003F        	dw 63  ; DRM - Number of directory entries - 1
   43 0131  80          	db 128 ; AL0 - 1 bit set per directory block
   44 0132  00          	db 0   ; AL1 - ... 8 more bits
   45 0133  0000        	dw 0   ; CKS - DIR check vector size (DRM+1)/4 (0=fixed disk)
   46 0135  0002        	dw 2   ; OFF - Reserved tracks
   47         000F      dpblen  equ $-dpb
   48                   
   49 0137  00 3F 3F 3F fcb:    db 0,"????????","???"
   50 0143    0014              ds 20
   51                   
   52                           end
 0 Error(s) Detected.
 87 Absolute Bytes. 9 Symbols Detected.
