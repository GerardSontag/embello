\ install library packages in flash
\ needs h
\ includes d

( cornerstone ) <<<hal-oxs>>>
compiletoflash

( code-start, see code-size below ) here

\ include ../flib/sdcard.fs
include ../flib/rf69.fs
include ../flib/oled.fs
include ../mlib/graphics.fs
include ../mlib/multi.fs

PA0 constant VAC-IN
PB0 constant VBAT-IN
PB1 constant VBAT-GND
PB5 constant DCF77-IN
PC0 constant PULSE1
PC1 constant PULSE2
PC2 constant PULSE3
PC3 constant CT1
PC4 constant CT2
PC5 constant CT3

: vbat ( -- mvolt )
  VBAT-IN adc 3300 * 4 * 4095 / ;

: config-pins ( -- )
  +adc
  +uart-irq ( uart. )

  omode-pp   VBAT-GND io-mode!  VBAT-GND ioc!
  imode-pull DCF77-IN io-mode!  DCF77-IN ioc!
  imode-pull PULSE1   io-mode!  PULSE1 ioc!
  imode-pull PULSE2   io-mode!  PULSE2 ioc!
  imode-pull PULSE3   io-mode!  PULSE3 ioc!
  imode-adc  VAC-IN   io-mode!
  imode-adc  VBAT-IN  io-mode!
  imode-adc  CT1      io-mode!
  imode-adc  CT2      io-mode!
  imode-adc  CT3      io-mode!
;

( code-size ) here swap - .
cornerstone <<<lib-oxs>>>
( flash-end ) here hex.
include d
\ vim: set ft=forth :
